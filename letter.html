<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Th∆∞ Gi√°ng Sinh üíå</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --color-env: #c41e3a;
            --color-env2: #a01729;
            --color-flap: #2e7d32;
            --color-bg: #165016;
            --color-heart: #ff0000;
            --color-sparkle: #fff;
        }

        body {
            background: radial-gradient(circle at top, #1f1f41, #18101b 80%);
            margin: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            cursor: auto;
            position: relative;
            overflow: hidden; 
            font-family: 'Poppins', sans-serif;
        }

        /* --- Envelope Styles --- */
        .envlope-wrapper {
            height: 380px;
            margin-top: 50px;
            animation: float 3s ease-in-out infinite;
            z-index: 10;
        }

        #envelope {
            position: relative;
            width: 380px;
            height: 240px;
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
            margin: 0 auto;
            top: 150px;
            background-color: var(--color-flap);
            box-shadow: 0 4px 20px rgba(0,0,0,.1);
            transition: transform 0.3s;
        }

        .front {
            position: absolute;
            width: 0;
            height: 0;
            z-index: 3;
        }

        .flap {
            border-left: 190px solid transparent;
            border-right: 190px solid transparent;
            border-bottom: 92px solid transparent;
            border-top: 150px solid var(--color-flap);
            transform-origin: top;
            pointer-events: none;
        }

        .pocket {
            border-left: 190px solid var(--color-env);
            border-right: 190px solid var(--color-env);
            border-bottom: 90px solid var(--color-env2);
            border-top: 150px solid transparent;
            border-bottom-left-radius: 6px;
            border-bottom-right-radius: 6px;
        }

        .letter {
            position: relative;
            background-color: #e0c784;
            width: 95%;
            margin: 0 auto;
            height: 95%;
            top: 0%;
            border-radius: 15px;
            box-shadow: 0 2px 26px rgba(0,0,0,.08);
            padding: 15px;
            box-sizing: border-box;
            border: 6px solid;
            border-image: repeating-linear-gradient(45deg, #ff0000 0 10px, #ffffff 10px 20px) 1;
        }
        
        /* Opening Animations */
        .open .flap {
            transform: rotateX(180deg);
            transition: transform 0.4s ease, z-index 0.6s;
            z-index: 1;
        }

        .close .flap {
            transform: rotateX(0deg);
            transition: transform 0.4s 0.6s ease, z-index 1s;
            z-index: 5;
        }

        .close .letter {
            transform: translateY(0px); 
            transition: transform 0.4s ease, z-index 1s;
            z-index: 1;
        }

        .open .letter {
            transform: translateY(-60px) rotate(-3deg);
            transition: transform 0.4s 0.6s ease, z-index 0.6s;
            z-index: 2;
        }

        /* --- Decor --- */
        .hearts, .sparkles { position: absolute; top: 90px; left: 0; right: 0; z-index: 2; }
        .heart, .sparkle { position: absolute; bottom: 0; pointer-events: none; }
        .heart:before, .heart:after {
            content: ""; position: absolute; left: 25px; top: 0; width: 25px; height: 40px;
            background: var(--color-heart); border-radius: 25px 25px 0 0;
            transform: rotate(-45deg); transform-origin: 0 100%;
        }
        .heart:after { left: 0; transform: rotate(45deg); transform-origin: 100% 100%; }
        .sparkle { width: 8px; height: 8px; background: var(--color-sparkle); border-radius: 50%; animation: sparkleTwinkle 1s infinite; }
        .close .heart, .close .sparkle { opacity: 0; animation: none; }
        .a1 { left: 20%; transform: scale(0.6); animation: slideUp 4s linear infinite, sideSway 2s ease-in-out infinite alternate; }
        .a2 { left: 55%; animation: slideUp 5s linear infinite, sideSway 4s ease-in-out infinite alternate; }
        .a3 { left: 10%; transform: scale(0.8); animation: slideUp 7s linear infinite, sideSway 2s ease-in-out infinite alternate; }
        .s1 { left: 30%; animation: sparkleUp 3s linear infinite; }
        .s2 { left: 60%; animation: sparkleUp 4s linear infinite; }
        .s3 { left: 45%; animation: sparkleUp 5s linear infinite; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes slideUp { 0% { top: 0; } 100% { top: -600px; } }
        @keyframes sideSway { 0% { margin-left: 0; } 50% { margin-left: 50px; } 100% { margin-left: 0; } }
        @keyframes sparkleUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-500px) rotate(360deg); opacity: 0; } }
        @keyframes sparkleTwinkle { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.5); } }

        /* --- Controls --- */
        .controls { text-align: center; margin-top: 80px; z-index: 11; position: relative; }
        .controls button {
            font-weight: 600;
            background: linear-gradient(135deg, #c41e3a, #a01729, #2e7d32);
            border: 2px solid #ffd700;
            border-radius: 25px;
            color: white;
            padding: 12px 28px;
            font-size: 17px;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2), 0 0 10px rgba(255, 215, 0, 0.4);
            transition: all 0.35s ease;
        }
        .controls button:hover { transform: translateY(-4px) scale(1.07); box-shadow: 0 6px 25px rgba(0,0,0,0.25), 0 0 14px rgba(255, 215, 0, 0.6); }

        /* --- Music Control --- */
        .music-control {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 200000; /* Ensure on top of everything */
            display: none;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .music-control.show {
            display: flex; /* Flex to center icon */
            opacity: 1;
        }
        .music-btn {
            background: radial-gradient(circle at 30% 30%, #fff, #f0e6c0);
            border: 2px solid #d4af37;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 22px;
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), 0 4px 10px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            color: #c41e3a;
            outline: none;
        }
        .music-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }
        .music-btn.playing i {
            animation: noteBounce 1.5s infinite ease-in-out;
        }
        @keyframes noteBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        /* --- Background Elements --- */
        .star-field { position: fixed; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; }
        .star { position: absolute; width: 3px; height: 3px; background: white; border-radius: 50%; opacity: 0; animation: twinkle 2s infinite ease-in-out; }
        @keyframes twinkle { 0% { opacity: 0; transform: scale(0.5); } 50% { opacity: 1; transform: scale(1.5); } 100% { opacity: 0; transform: scale(0.5); } }
        .snowflake { position: fixed; top: -10px; color: white; font-size: 12px; opacity: 0.8; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { 0% { transform: translateY(0) rotate(0deg); opacity: 0.9; } 100% { transform: translateY(100vh) rotate(360deg); opacity: 0.2; } }
        .santa { position: fixed; bottom: 5%; right: -400px; width: 400px; animation: flySanta 12s linear infinite; z-index: 9999; }
        @media (max-width: 768px) { .santa { top: 50%; width: 250px; right: -250px; } }
        @keyframes flySanta { 0% { transform: translateX(0); } 100% { transform: translateX(-150vw); } }

        /* --- MODAL OVERLAY (DARK BG) --- */
        #modalOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Darker to make fireworks pop */
            z-index: 99980;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
            backdrop-filter: blur(3px);
        }
        #modalOverlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        /* --- FIREWORKS CANVAS --- */
        #fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; 
            z-index: 99990; /* Above Overlay, Below Letter */
        }

        /* --- MODERN BIRTHDAY CARD MODAL --- */
        #letterModal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            /* No background here, moved to overlay */
            z-index: 99995;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Changed from center to allow scrolling long letters */
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
            overflow-y: auto; /* Allow scrolling the entire modal wrapper */
            padding-top: 40px; /* Space from top */
            padding-bottom: 40px;
        }
        #letterModal.show {
            opacity: 1;
            pointer-events: auto;
        }
        
        .modal-content {
            /* Clean Birthday Card Style */
            background-color: #fffdf9; /* Warm white */
            width: 90%;
            max-width: 650px;
            height: auto;
            /* Removed fixed height/overflow to allow content to dictate size */
            min-height: 300px;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            padding: 60px 40px; /* Increased padding */
            text-align: center;
            border: 1px solid #f0f0f0;
            z-index: 99999; /* Topmost */
            margin: auto 0; /* Center vertically if short, scroll if long */
        }

        /* Subtle Inner Border */
        .modal-content::after {
            content: "";
            position: absolute;
            top: 15px; left: 15px; right: 15px; bottom: 15px;
            border: 2px dashed #e8d5b5;
            border-radius: 8px;
            pointer-events: none;
            z-index: 1;
        }

        /* Decoration Elements (Icons) */
        .deco-icon {
            position: absolute;
            z-index: 5;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.1));
        }
        .deco-tl { top: -25px; left: -10px; color: #FF9AA2; font-size: 60px; transform: rotate(-15deg); animation: floatBalloon 4s ease-in-out infinite; }
        .deco-tr { top: 20px; right: 25px; color: #FFB7B2; font-size: 30px; animation: twinkle 3s infinite; }
        .deco-bl { bottom: 20px; left: 25px; color: #B5EAD7; font-size: 35px; }
        .deco-br { bottom: -10px; right: -10px; color: #E2F0CB; font-size: 50px; transform: rotate(10deg); }

        @keyframes floatBalloon {
            0%, 100% { transform: translateY(0) rotate(-15deg); }
            50% { transform: translateY(-10px) rotate(-10deg); }
        }
        
        .modal-inner {
            position: relative;
            z-index: 10;
            width: 100%;
            min-height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .modal-close-icon {
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 35px; 
            cursor: pointer;
            color: #aaa;
            z-index: 20;
            transition: all 0.3s;
            line-height: 1;
            background: #fff;
            border-radius: 50%;
            width: 40px; height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .modal-close-icon:hover { 
            color: #ff6b6b; 
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        /* Typography - Simple & Clean */
        .typing-container {
            font-family: 'Nunito', sans-serif;
            font-size: 1.25rem;
            color: #4a4a4a; 
            line-height: 1.8;
            text-align: left;
            width: 100%;
            margin-bottom: 30px;
            min-height: 150px;
            white-space: pre-wrap;
            font-weight: 600;
        }
        
        .cursor {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background-color: #4a4a4a;
            margin-left: 2px;
            vertical-align: middle;
            animation: blink 0.8s infinite;
        }
        
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Elegant Signature with Writing Animation */
        .signature {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            color: #c41e3a; /* Deep Red */
            font-weight: bold;
            margin-top: 20px;
            align-self: flex-end;
            margin-right: 40px;
            transform: rotate(-5deg);
            
            /* Animation Setup */
            white-space: nowrap;
            overflow: hidden;
            width: 0; /* Start hidden */
            opacity: 0;
        }
        .signature.visible { 
            opacity: 1;
            animation: signWrite 2.5s steps(40) forwards; 
        }

        @keyframes signWrite {
            from { width: 0; }
            to { width: 250px; } /* Adjust width based on text length */
        }

        /* Button inside Modal */
        .close-letter-btn {
            background: #4a4a4a;
            border: none;
            color: #fff;
            padding: 10px 35px;
            border-radius: 50px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            margin-top: 30px;
            opacity: 0;
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .close-letter-btn.visible { opacity: 1; }
        .close-letter-btn:hover {
            background: #ff6b6b;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.3);
        }

        /* Scrollbar styling */
        .modal-content::-webkit-scrollbar { width: 6px; }
        .modal-content::-webkit-scrollbar-track { background: transparent; }
        .modal-content::-webkit-scrollbar-thumb { background: #ddd; border-radius: 4px; }
        .nav-btn{
  position:fixed;
  top:20px;
  width:46px;
  height:46px;
  border-radius:50%;
  background:rgba(255,255,255,.15);
  backdrop-filter:blur(12px);
  border:1px solid rgba(255,255,255,.3);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:1.4rem;
  cursor:pointer;
  z-index:999;
  transition:.35s ease;
  box-shadow:0 8px 25px rgba(0,0,0,.4);
}

.nav-btn:hover{
  transform:scale(1.1);
  box-shadow:0 0 20px rgba(248,178,41,.8);
}

.nav-left{left:20px}
.nav-right{right:20px}

/* ===== PAGE LOADER ===== */
#page-loader{
  position:fixed;
  inset:0;
  background:radial-gradient(circle at top,#0b1a4a,#050f2c 70%);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
  transition:opacity .8s ease, visibility .8s ease;
}

#page-loader.hide{
  opacity:0;
  visibility:hidden;
}

.loader-content{
  text-align:center;
  color:#fff;
}

.loader-content h2{
  font-family:'Playfair Display',serif;
  font-size:2.4rem;
  color:#f8b229;
  text-shadow:0 0 20px rgba(248,178,41,.8);
  margin-bottom:20px;
}

.tree{
  font-size:4rem;
  animation:treeGlow 2s infinite alternate;
  margin-bottom:10px;
}

@keyframes treeGlow{
  from{filter:drop-shadow(0 0 10px #f8b229)}
  to{filter:drop-shadow(0 0 30px #ffd56a)}
}

.progress-wrap{
  width:260px;
  height:10px;
  background:rgba(255,255,255,.2);
  border-radius:999px;
  overflow:hidden;
  margin:20px auto;
}

.progress-bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#f8b229,#ffd56a,#fff);
  box-shadow:0 0 15px rgba(248,178,41,.9);
  animation:loading 2.5s infinite;
}

@keyframes loading{
  0%{width:0%}
  60%{width:100%}
  100%{width:100%}
}

.loader-content p{
  opacity:.8;
  font-style:italic;
}

    </style>
</head>
<body>
    <div class="nav-btn nav-left" onclick="goTree()">
  ‚¨Ö
</div>

<div id="page-loader">
  <div class="loader-content">
    <div class="tree">üéÑ</div>
    <h2>Loading...</h2>

    <div class="progress-wrap">
      <div class="progress-bar"></div>
    </div>

    <p>V·∫°n v·∫≠t ƒë·∫øn t·ª´ em...</p>
  </div>
</div>

    <!-- Dark Overlay for Modal Background -->
    <div id="modalOverlay"></div>

    <!-- Fireworks Layer -->
    <canvas id="fireworksCanvas"></canvas>

    <!-- Background Elements -->
    <img src="https://i.pinimg.com/originals/7f/1f/76/7f1f76ac29bc01ad318abbf0468b1062.gif" class="santa" alt="Santa">
    <div class="star-field"></div>
    
    <!-- Envelope Wrapper -->
    <div class="envlope-wrapper">
        <div id="envelope" class="close">
            <div class="wax-seal"></div>
            <div class="front flap"></div>
            <div class="front pocket"></div>
            <div class="letter">
                <!-- Visual placeholder only -->
                <div style="width: 100%; height: 100%; background: #e0c784; opacity: 0.5;"></div>
            </div>
            <div class="hearts">
                <div class="heart a1"></div>
                <div class="heart a2"></div>
                <div class="heart a3"></div>
            </div>
            <div class="sparkles">
                <div class="sparkle s1"></div>
                <div class="sparkle s2"></div>
                <div class="sparkle s3"></div>
            </div>
        </div>
    </div>

    <!-- Controls -->
    <div class="controls">
        <button id="openBtn">M·ªü Th∆∞</button>
        <button id="resetBtn" style="display: none;">ƒê√≥ng Th∆∞</button>
    </div>
    
    <!-- Music Controls (Bottom Right) -->
    <div id="musicControl" class="music-control">
        <button id="musicBtn" class="music-btn" title="D·ª´ng/Ph√°t Nh·∫°c">
            <i>üéµ</i>
        </button>
    </div>

    <!-- Audio -->
    <audio id="sound" loop>
        <source src="mysunshine.mp3" type="audio/mpeg" />
    </audio>

    <!-- Modal (Modern Birthday Style) -->
    <div id="letterModal">
        <div class="modal-content">
            <!-- Decorative Elements -->
            <i class="fa-solid fa-balloon deco-icon deco-tl"></i>
            <i class="fa-solid fa-star deco-icon deco-tr"></i>
            <i class="fa-solid fa-gift deco-icon deco-bl"></i>
            <i class="fa-solid fa-cake-candles deco-icon deco-br"></i>

            <div class="modal-close-icon" id="closeModalIcon">&times;</div>
            <div class="modal-inner">
                <div id="typingText" class="typing-container"></div>
                <div id="signature" class="signature">Nh∆∞ Khoa</div>
                <button id="modalCloseBtn" class="close-letter-btn">ƒê√≥ng Th∆∞</button>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        // Hi·ªán loader khi load trang
window.addEventListener('load', () => {
  // Gi·∫£ l·∫≠p th·ªùi gian load data (Cloudinary / localStorage)
  setTimeout(() => {
    document.getElementById('page-loader').classList.add('hide');
  }, 1800); // ch·ªânh nhanh/ch·∫≠m tu·ª≥ √Ω
});


        // --- TEXT DATA ---
        const messageLines = [
    "G·ª≠i em b√© c·ªßa anh,",
    "Anh t·ª´ng nghe n√≥i: 'ƒê·ªùi m·ªói ng∆∞·ªùi s·∫Ω g·∫∑p kho·∫£ng 29,2 tri·ªáu ng∆∞·ªùi, x√°c su·∫•t ƒë·ªÉ hai ng∆∞·ªùi y√™u nhau l√† 0,000049'.",
    "V·∫≠y m√† ch√∫ng ta t√¨m th·∫•y nhau‚Ä¶ v√† r·ªìi ch·ªâ m·ªõi qua v√†i ng√†y t√¨m hi·ªÉu, m√¨nh ƒë√£ c√≥ th·ªÉ n√≥i chuy·ªán v·ªõi nhau m√† kh√¥ng ai ƒë·ªÉ √Ω ƒë·ªìng h·ªì, chia s·∫ª v·ªõi nhau v√¥ v√†n th·ª© tr√™n ƒë·ªùi m√† ch·∫≥ng c√≥ ch√∫t d√® ch·ª´ng hay ƒë·ªÅ ph√≤ng. Anh th·∫•y ƒë√¢y th·ª±c s·ª± l√† m·ªôt s·ª± s·∫Øp ƒë·∫∑t t·ª´ √¥ng tr·ªùi. C√≥ l·∫Ω √¥ng ƒë√£ th·∫≠t kh√©o l√©o khi g·ª≠i anh ƒë·∫øn b√™n em ‚Äì ƒë·ªÉ xoa d·ªãu nh·ªØng v·∫øt th∆∞∆°ng em t·ª´ng ph·∫£i m·ªôt m√¨nh g√°nh ch·ªãu, ƒë·ªÉ tr·ªü th√†nh b·ªù vai m√† em c√≥ th·ªÉ t·ª±a v√†o m·ªói khi m·ªát m·ªèi. üí´",
    "Anh ch·∫≥ng bi·∫øt vi·ªác c·∫£m h√≥a m·ªôt c√¥ g√°i t·ª´ m·∫°nh m·∫Ω c·ª©ng r·∫Øn th√†nh m·ªôt c√¥ b√© d·ªÖ r∆°i n∆∞·ªõc m·∫Øt l√† n√™n hay kh√¥ng, nh∆∞ng anh mu·ªën em bi·∫øt r·∫±ng nh·ªØng gi·ªçt n∆∞·ªõc m·∫Øt ƒë√≥ kh√¥ng ph·∫£i l√† y·∫øu ƒëu·ªëi, m√† l√† v√¨ em ƒë√£ tin t∆∞·ªüng anh ƒë·ªß ƒë·ªÉ cho ph√©p m√¨nh ƒë∆∞·ª£c m·ªÅm l√≤ng. V√† anh s·∫Ω lu√¥n ·ªü ƒë√¢y, l√† ch·ªó d·ª±a v·ªØng ch·∫Øc cho em, l√† tia n·∫Øng ·∫•m √°p xuy√™n qua nh·ªØng ƒë√°m m√¢y u √°m t·ª´ng bao tr√πm quanh em. ‚òÄÔ∏è",
    "",
    "C≈©ng gi·ªëng nh∆∞ em, anh t·ª´ng nghƒ© s·ªëng c√¥ ƒë∆°n ch·∫≥ng c√≥ g√¨ l√† kh√≥ - m·ªôt m√¨nh t·ª± do, m·ªôt m√¨nh t·ª± t·∫°i. Nh∆∞ng t·ª´ khi g·∫∑p em, t·ª´ khi c√≥ em‚Ä¶ anh ch·∫≥ng mu·ªën quay l·∫°i th·ªùi gian ƒë√≥ m·ªôt l·∫ßn n√†o n·ªØa.",
    "H√£y ƒë·ªÉ anh tr·ªü th√†nh m·ªôt th√≥i quen c·ªßa em nh√©, gi·ªëng nh∆∞ ly matcha Nh·∫≠t v√†o bu·ªïi s√°ng üçÉüçµ, nh∆∞ chi·∫øc √°o ·∫•m trong ƒë√™m ƒë√¥ng üß•, nh∆∞ n·ª• c∆∞·ªùi c·ªßa em khi th·∫•y morning text m·ªói s√°ng th·ª©c gi·∫•c. üí≠",
    "",
    "ƒê√¢y l√† l·∫ßn ƒë·∫ßu ti√™n anh ƒë∆∞·ª£c ƒë√≥n sinh nh·∫≠t c√πng em. Nh∆∞ng d√π th√™m m·ªôt tu·ªïi m·ªõi, nh∆∞ng h√£y nh·ªõ em lu√¥n l√† em b√© c·ªßa anh - em b√© m√† anh mu·ªën che ch·ªü, mu·ªën d·ªó d√†nh, mu·ªën n·∫Øm tay ƒëi qua t·ª´ng ng√†y.",
    "Ch√∫c em tu·ªïi m·ªõi s·∫Ω th√†nh c√¥ng v·ªõi nh·ªØng d·ª± ƒë·ªãnh m√† b·∫£n th√¢n ƒëang theo ƒëu·ªïi üéØ",
    "S·∫Ω c√≥ s·ª©c kh·ªèe ƒë·ªÉ h·ªçc t·∫≠p, l√†m vi·ªác th·∫≠t t·ªët üí™",
    "S·∫Ω c∆∞·ªùi t∆∞∆°i th·∫≠t r·∫°ng r·ª° üòä",
    "V√† s·∫Ω lu√¥n l√† em b√© c·ªßa anh. üéÇ",
    "",
    "C√πng v·ªõi ƒë√≥, Gi√°ng Sinh c≈©ng s·∫Øp ƒë·∫øn r·ªìi. M√πa Gi√°ng Sinh n√†y anh ch∆∞a th·ªÉ ƒë·∫øn b√™n c·∫°nh em, nh∆∞ng tr√°i tim anh lu√¥n h∆∞·ªõng v·ªÅ em ‚Äì",
    "Qua t·ª´ng tin nh·∫Øn üí¨",
    "Qua t·ª´ng cu·ªôc g·ªçi üìû",
    "Qua t·ª´ng suy nghƒ© v·ªÅ em m·ªói khi nh·∫Øm m·∫Øt v√† c·∫£ l√∫c v·ª´a t·ªânh gi·∫•c. üí≠",
    "Cho n√™n Qu·ª≥nh Nh∆∞ h√£y y√™n t√¢m v√† ch·ªù anh nh√©. ‚ù§Ô∏è",
    "",
    "C·∫£m ∆°n em ƒë√£ xu·∫•t hi·ªán trong cu·ªôc ƒë·ªùi anh nh∆∞ m·ªôt ph√©p m√†u gi·ªØa nh·ªØng ng√†y th√°ng ƒë∆°n ƒëi·ªáu. Anh bi·∫øt em c√≥ th·ªÉ xinh ƒë·∫πp nh∆∞ n√†ng th∆° üå∏, em c√≥ th·ªÉ ƒë√°ng y√™u nh∆∞ em b√© üß∏, em c√≥ th·ªÉ quy·∫øn r≈© nh∆∞ m·ªôt b√¥ng hoa h·ªìng gi·ªØa v∆∞·ªùn xu√¢n üåπ, em c√≥ th·ªÉ m·∫°nh m·∫Ω nh∆∞ m·ªôt chi·∫øn binh üí™, v√† em c≈©ng c√≥ th·ªÉ y·∫øu ƒëu·ªëi v√† c·∫ßn ƒë∆∞·ª£c che ch·ªü nh∆∞ m·ªôt ch√∫ m√®o con üê±. Anh y√™u t·∫•t c·∫£ nh·ªØng s·∫Øc th√°i ƒë√≥ c·ªßa em. Y√™u c·∫£ nh·ªØng l√∫c em c∆∞·ªùi r·∫°ng r·ª° l·∫´n nh·ªØng l√∫c em y·∫øu m·ªÅm.",
    "",
    "Em √†‚Ä¶ mong r·∫±ng t·ª´ gi·ªù ƒë·∫øn v·ªÅ sau, ch√∫ng m√¨nh s·∫Ω c√πng nhau vi·∫øt n√™n nh·ªØng trang truy·ªán t√¨nh ƒë·∫πp nh·∫•t, m·ªôt t√°c ph·∫©m t√¨nh y√™u ƒë·∫πp nh·∫•t d√†nh ri√™ng cho hai ta. üìñ",
    "",
    "Anh y√™u em r·∫•t nhi·ªÅuuu! ‚ù§Ô∏èüéÑüéÇ",
     "                                                       Anh y√™u c·ªßa em b√©",
];
        
        const fullText = messageLines.join("\n\n");

        // --- FIREWORKS ENGINE ---
        // shim layer with setTimeout fallback
        window.requestAnimFrame = (function(){
          return  window.requestAnimationFrame       ||
                  window.webkitRequestAnimationFrame ||
                  window.mozRequestAnimationFrame    ||
                  function( callback ){
                    window.setTimeout(callback, 1000 / 60);
                  };
        })();

        var canvas = document.getElementById( 'fireworksCanvas' ),
            ctx = canvas.getContext( '2d' ),
            cw = window.innerWidth,
            ch = window.innerHeight,
            fireworks = [],
            particles = [],
            hue = 120,
            limiterTotal = 20,
            limiterTick = 0,
            timerTotal = 60, // Slower frequency as requested
            timerTick = 0,
            animationId = null, // To control loop
            mousedown = false,
            mx,
            my;
            
        canvas.width = cw;
        canvas.height = ch;
        
        window.addEventListener('resize', function() {
            cw = window.innerWidth;
            ch = window.innerHeight;
            canvas.width = cw;
            canvas.height = ch;
        });

        function random( min, max ) {
            return Math.random() * ( max - min ) + min;
        }

        function calculateDistance( p1x, p1y, p2x, p2y ) {
            var xDistance = p1x - p2x,
                yDistance = p1y - p2y;
            return Math.sqrt( Math.pow( xDistance, 2 ) + Math.pow( yDistance, 2 ) );
        }

        function Firework( sx, sy, tx, ty ) {
            this.x = sx;
            this.y = sy;
            this.sx = sx;
            this.sy = sy;
            this.tx = tx;
            this.ty = ty;
            this.distanceToTarget = calculateDistance( sx, sy, tx, ty );
            this.distanceTraveled = 0;
            this.coordinates = [];
            this.coordinateCount = 3;
            while( this.coordinateCount-- ) {
                this.coordinates.push( [ this.x, this.y ] );
            }
            this.angle = Math.atan2( ty - sy, tx - sx );
            this.speed = 2;
            this.acceleration = 1.02; // Slower ascent
            this.brightness = random( 50, 70 );
            this.targetRadius = 1;
        }

        Firework.prototype.update = function( index ) {
            this.coordinates.pop();
            this.coordinates.unshift( [ this.x, this.y ] );
            
            if( this.targetRadius < 8 ) {
                this.targetRadius += 0.3;
            } else {
                this.targetRadius = 1;
            }
            
            this.speed *= this.acceleration;
            
            var vx = Math.cos( this.angle ) * this.speed,
                vy = Math.sin( this.angle ) * this.speed;
            this.distanceTraveled = calculateDistance( this.sx, this.sy, this.x + vx, this.y + vy );
            
            if( this.distanceTraveled >= this.distanceToTarget ) {
                createParticles( this.tx, this.ty );
                fireworks.splice( index, 1 );
            } else {
                this.x += vx;
                this.y += vy;
            }
        }

        Firework.prototype.draw = function() {
            ctx.beginPath();
            ctx.moveTo( this.coordinates[ this.coordinates.length - 1][ 0 ], this.coordinates[ this.coordinates.length - 1][ 1 ] );
            ctx.lineTo( this.x, this.y );
            ctx.strokeStyle = 'hsl(' + hue + ', 100%, ' + this.brightness + '%)';
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }

        function Particle( x, y ) {
            this.x = x;
            this.y = y;
            this.coordinates = [];
            this.coordinateCount = 5;
            while( this.coordinateCount-- ) {
                this.coordinates.push( [ this.x, this.y ] );
            }
            this.angle = random( 0, Math.PI * 2 );
            this.speed = random( 1, 15 ); // Faster expansion
            this.friction = 0.95;
            this.gravity = 0.6; // Gravity restored
            this.hue = random( hue - 20, hue + 20 );
            this.brightness = random( 50, 80 );
            this.alpha = 1;
            this.decay = random( 0.0075, 0.009 ); // Slow decay
        }

        Particle.prototype.update = function( index ) {
            this.coordinates.pop();
            this.coordinates.unshift( [ this.x, this.y ] );
            this.speed *= this.friction;
            this.x += Math.cos( this.angle ) * this.speed;
            this.y += Math.sin( this.angle ) * this.speed + this.gravity;
            this.alpha -= this.decay;
            
            if( this.alpha <= this.decay ) {
                particles.splice( index, 1 );
            }
        }

        Particle.prototype.draw = function() {
            ctx.beginPath();
            ctx.moveTo( this.coordinates[ this.coordinates.length - 1 ][ 0 ], this.coordinates[ this.coordinates.length - 1 ][ 1 ] );
            ctx.lineTo( this.x, this.y );
            ctx.strokeStyle = 'hsla(' + this.hue + ', 100%, ' + this.brightness + '%, ' + this.alpha + ')';
            ctx.lineWidth = 2; // Thicker particles
            ctx.stroke();
        }

        function createParticles( x, y ) {
            var particleCount = 50; // Increased count
            while( particleCount-- ) {
                particles.push( new Particle( x, y ) );
            }
        }

        function loop() {
            animationId = requestAnimFrame( loop );
            hue += 0.5;
            
            ctx.globalCompositeOperation = 'destination-out';
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect( 0, 0, cw, ch );
            ctx.globalCompositeOperation = 'lighter';
            
            var i = fireworks.length;
            while( i-- ) {
                fireworks[ i ].draw();
                fireworks[ i ].update( i );
            }
            
            var i = particles.length;
            while( i-- ) {
                particles[ i ].draw();
                particles[ i ].update( i );
            }
            
            // Random Launch Logic
            if( timerTick >= timerTotal ) {
                // Determine random side: 0 = Left, 1 = Right
                var side = Math.random() < 0.5 ? 0 : 1;
                var sx, tx;

                if (side === 0) {
                    // LEFT SIDE
                    sx = random(0, cw * 0.2); // Start bottom left
                    tx = random(0, cw * 0.3); // Target left area
                } else {
                    // RIGHT SIDE
                    sx = random(cw * 0.8, cw); // Start bottom right
                    tx = random(cw * 0.7, cw); // Target right area
                }
                
                // Target Height: Top 50%
                var ty = random(ch * 0.1, ch * 0.5);

                fireworks.push( new Firework( sx, ch, tx, ty ) );
                timerTick = 0;
            } else {
                timerTick++;
            }
            
            // Mouse interaction
            if( limiterTick >= limiterTotal ) {
                if( mousedown ) {
                    fireworks.push( new Firework( cw / 2, ch, mx, my ) );
                    limiterTick = 0;
                }
            } else {
                limiterTick++;
            }
        }

        function startFireworks() {
            if (!animationId) {
                loop();
            }
        }

        function stopFireworks() {
            if (window.cancelAnimationFrame) {
                 window.cancelAnimationFrame(animationId);
            } else {
                 clearTimeout(animationId);
            }
            animationId = null;
            ctx.clearRect(0, 0, cw, ch);
            fireworks = [];
            particles = [];
            timerTick = 0;
        }

        // Mouse event bindings
        canvas.addEventListener( 'mousemove', function( e ) {
            mx = e.pageX - canvas.offsetLeft;
            my = e.pageY - canvas.offsetTop;
        });

        canvas.addEventListener( 'mousedown', function( e ) {
            e.preventDefault();
            mousedown = true;
        });

        canvas.addEventListener( 'mouseup', function( e ) {
            e.preventDefault();
            mousedown = false;
        });

        // --- MAIN PAGE LOGIC ---
        $(document).ready(function () {
            const envelope = $('#envelope');
            const openBtn = $("#openBtn");
            const resetBtn = $("#resetBtn");
            const modal = $("#letterModal");
            const modalOverlay = $("#modalOverlay");
            const typingContainer = document.getElementById("typingText");
            const signature = $("#signature");
            const modalCloseBtn = $("#modalCloseBtn"); 
            const audio = document.getElementById("sound");
            const musicControl = $("#musicControl");
            const musicBtn = $("#musicBtn");
            let typingInterval;

            // Christmas bg effects
            const starField = document.querySelector('.star-field');
            if(starField) {
                for (let i = 0; i < 200; i++) {
                    const star = document.createElement('div');
                    star.classList.add('star');
                    star.style.left = Math.random() * 100 + 'vw';
                    star.style.top = Math.random() * 100 + 'vh';
                    star.style.animationDelay = Math.random() * 5 + 's';
                    star.style.animationDuration = (2 + Math.random() * 3) + 's';
                    starField.appendChild(star);
                }
            }
            setInterval(() => {
                const snow = document.createElement("div");
                snow.classList.add("snowflake");
                snow.textContent = "‚ùÑ";
                snow.style.left = Math.random() * 100 + "vw";
                snow.style.animationDuration = 5 + Math.random() * 5 + "s"; 
                snow.style.fontSize = (10 + Math.random() * 15) + "px"; 
                document.body.appendChild(snow);
                setTimeout(() => snow.remove(), 10000);
            }, 150);

            // Music Button Logic
            musicBtn.on('click', function() {
                if (audio.paused) {
                    audio.play();
                    $(this).addClass("playing");
                    $(this).find('i').text("üéµ");
                } else {
                    audio.pause();
                    $(this).removeClass("playing");
                    $(this).find('i').text("‚è∏");
                }
            });

            // Open Action
            openBtn.on('click', function () {
                envelope.removeClass("close").addClass("open");
                openBtn.hide();
                resetBtn.show();
                
                // Play Audio & Show Control
                playAudioOnce();

                setTimeout(() => {
                    modalOverlay.addClass("show"); // Show dark bg first
                    startFireworks(); 
                    showModalAndType();
                }, 1000);
            });

            // Close Actions
            resetBtn.on('click', closeEverything);
            $("#closeModalIcon").on('click', closeEverything);
            modalCloseBtn.on('click', closeEverything); 

            function closeEverything() {
                envelope.removeClass("open").addClass("close");
                modal.removeClass("show");
                modalOverlay.removeClass("show");
                stopFireworks();
                
                openBtn.show();
                resetBtn.hide();
                
                // Hide Music Control and pause
                musicControl.removeClass("show");
                audio.pause();
                musicBtn.removeClass("playing").find('i').text("üéµ");

                // Reset Typing
                clearInterval(typingInterval);
                typingContainer.innerHTML = "";
                signature.removeClass("visible");
                modalCloseBtn.removeClass("visible");
            }

            function playAudioOnce() {
                audio.currentTime = 21; 
                audio.play()
                    .then(() => {
                        musicControl.addClass("show");
                        musicBtn.addClass("playing");
                    })
                    .catch(e => {
                        console.log("Audio play failed:", e);
                        // Still show button even if play failed
                        musicControl.addClass("show");
                    });
            }

            function showModalAndType() {
                modal.addClass("show");
                typingContainer.innerHTML = '<span class="cursor"></span>';
                signature.removeClass("visible");
                modalCloseBtn.removeClass("visible");

                let i = 0;
                typingInterval = setInterval(() => {
                    if (i < fullText.length) {
                        const char = fullText.charAt(i);
                        if (char === '\n') {
                            $('<br>').insertBefore('.cursor');
                        } else {
                            $('<span>' + char + '</span>').insertBefore('.cursor');
                        }
                        
                        // Auto-scroll logic
                        const modalContent = document.querySelector('.modal-content');
                        // Calculate if we should scroll (if close to bottom)
                        if (modalContent) {
                            modalContent.scrollTop = modalContent.scrollHeight;
                        }
                        
                        i++;
                    } else {
                        clearInterval(typingInterval);
                        $('.cursor').remove(); 
                        signature.addClass("visible");
                        modalCloseBtn.addClass("visible");
                    }
                }, 50); 
            }
        });
    </script>
     <script>
      function goTree(){
        window.location.href = 'tree.html';
      }
      
    </script>
</body>
</html>